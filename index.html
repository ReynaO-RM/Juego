<!DOCTYPE html>
<html>
  <head>
    <title>Ergo VR | Meta Quest 3</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="Ergo VR Game for Meta Quest 3">
    
    <!-- A-Frame 1.4.0 estable -->
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    
    <!-- Nuestros scripts -->
    <script src="./assets/ocean.js"></script>
    <script src="./assets/runner.js"></script>
    
    <!-- Fuentes y estilos -->
    <link href="https://fonts.googleapis.com/css?family=Exo+2:400,700" rel="stylesheet">
    <link href="./assets/style.css" rel="stylesheet" />
    
    <style>
      body {
        margin: 0;
        padding: 0;
        overflow: hidden;
        font-family: 'Exo 2', sans-serif;
      }
      
      /* Ocultar todo excepto la escena VR */
      .notification-container,
      #cursor-mobile,
      .clickable {
        display: none !important;
      }
      
      /* Texto más grande para VR */
      a-text {
        font-family: 'Exo 2', sans-serif !important;
      }
    </style>
  </head>
  <body>
    <!-- Escena principal A-Frame -->
    <a-scene 
      vr-mode-ui="enabled: true"
      renderer="antialias: true; colorManagement: true;"
      background="color: #a3d0ed"
      fog="type: linear; color: #a3d0ed; near: 5; far: 20">
      
      <!-- Assets -->
      <a-assets>
        <!-- Mixins para árboles -->
        <a-mixin id="foliage" geometry="
            primitive: cone;
            segments-height: 1;
            segments-radial: 4;
            radius-bottom: 0.3;"
           material="color: white; flatShading: true;"></a-mixin>
        <a-mixin id="trunk" geometry="
            primitive: box;
            height: 0.5;
            width: 0.1;
            depth: 0.1;"
           material="color: #8B4513;"></a-mixin>
           
        <!-- Mixins para texto -->
        <a-mixin id="title" text="
            font: exo2semibold;
            height: 40;
            width: 40;
            opacity: 0.9;
            align: center;"></a-mixin>
        <a-mixin id="copy" text="
            font: exo2semibold;
            height: 5;
            width: 5;
            opacity: 0.8;
            align: center;"></a-mixin>
      </a-assets>
      
      <!-- Luces -->
      <a-entity light="type: directional; castShadow: true; intensity: 0.6; color: #D0EAF9"
                position="5 3 1"></a-entity>
      <a-light type="ambient" intensity="0.4" color="#B4C5EC"></a-light>
      
      <!-- Cámara VR -->
      <a-camera position="0 1.6 0">
        <!-- Instrucciones VR (flotantes) -->
        <a-entity position="0 0.2 -1" scale="0.5 0.5 0.5">
          <a-text id="vr-instructions" 
                  value="¡Bienvenido a ERGO VR!"
                  align="center" 
                  color="white" 
                  width="4"
                  opacity="0.8"></a-text>
        </a-entity>
      </a-camera>
      
      <!-- Océano -->
      <a-ocean depth="100" width="100" amplitude="0.05" amplitude-variance="0.1" 
               speed="2" speed-variance="1" opacity="0.9" density="40" color="#7AD2F7"></a-ocean>
      
      <!-- Icebergs -->
      <a-entity class="iceberg" geometry="primitive: cone; height: 1; radiusBottom: 0.5; radiusTop: 0.15"
                material="color: #E6F0FA; flatShading: true"
                position="3 -0.1 -1.5">
        <a-animation attribute="rotation" from="0 0 0" to="0 360 0" repeat="indefinite" dur="20000"></a-animation>
        <a-animation attribute="position" from="3 -0.1 -1.5" to="5 -0.1 -4" repeat="indefinite" 
                     direction="alternate" dur="15000"></a-animation>
      </a-entity>
      
      <!-- Área de juego principal -->
      <a-entity id="game-area" position="0 0 -10" rotation="0 0 0">
        
        <!-- Pista/cono principal -->
        <a-cone id="track" radius-bottom="2" radius-top="1.8" height="10" 
                position="0 -5 0" rotation="-90 0 0"
                material="color: #005DED; emissive: #005DED; emissiveIntensity: 0.1">
        </a-cone>
        
        <!-- Contenedor de árboles -->
        <a-entity id="tree-container" position="0 0 0">
          
          <!-- Plantillas de árboles -->
          <a-entity id="template-tree-left" class="tree-template" data-tree-position-index="0" 
                    position="-0.5 0.55 -7" scale="0.3 0.3 0.3" visible="false">
            <a-entity mixin="foliage"></a-entity>
            <a-entity mixin="trunk" position="0 -0.5 0"></a-entity>
            <a-animation attribute="position" 
                         from="-0.5 0.55 -7"
                         to="-0.5 0.55 2"
                         dur="5000"
                         repeat="0"></a-animation>
          </a-entity>
          
          <a-entity id="template-tree-center" class="tree-template" data-tree-position-index="1" 
                    position="0 0.6 -7" scale="0.3 0.3 0.3" visible="false">
            <a-entity mixin="foliage"></a-entity>
            <a-entity mixin="trunk" position="0 -0.5 0"></a-entity>
            <a-animation attribute="position" 
                         from="0 0.6 -7"
                         to="0 0.6 2"
                         dur="5000"
                         repeat="0"></a-animation>
          </a-entity>
          
          <a-entity id="template-tree-right" class="tree-template" data-tree-position-index="2" 
                    position="0.5 0.55 -7" scale="0.3 0.3 0.3" visible="false">
            <a-entity mixin="foliage"></a-entity>
            <a-entity mixin="trunk" position="0 -0.5 0"></a-entity>
            <a-animation attribute="position" 
                         from="0.5 0.55 -7"
                         to="0.5 0.55 2"
                         dur="5000"
                         repeat="0"></a-animation>
          </a-entity>
          
        </a-entity>
        
        <!-- Jugador -->
        <a-entity id="player" position="0 0.6 1.5">
          <a-sphere radius="0.08" color="#FF440C">
            <a-animation attribute="scale" from="1 1 1" to="1.1 1.1 1.1" 
                         repeat="indefinite" direction="alternate" dur="1000"></a-animation>
            <a-light type="point" color="#FF440C" intensity="0.5" distance="2"></a-light>
          </a-sphere>
        </a-entity>
        
        <!-- Puntuación -->
        <a-entity position="0 2 0">
          <a-text id="score" value="Puntuación: 0" 
                  align="center" color="white" width="3" scale="2 2 2"></a-text>
        </a-entity>
        
      </a-entity>
      
      <!-- Menús -->
      <a-entity id="menu-container" position="0 1.6 -2">
        
        <!-- Menú de inicio -->
        <a-entity id="start-menu" visible="true">
          <a-text value="ERGO VR" 
                  position="0 0.5 0"
                  align="center"
                  color="white"
                  width="4"
                  scale="2 2 2"></a-text>
          
          <a-text id="start-copy-desktop"
                  value="Joystick izquierdo: Mover\nBotón A: Empezar"
                  position="0 -0.2 0"
                  align="center"
                  color="#CCCCCC"
                  width="3"
                  scale="1 1 1"></a-text>
        </a-entity>
        
        <!-- Menú de fin del juego -->
        <a-entity id="game-over" visible="false">
          <a-text value="FIN DEL JUEGO"
                  position="0 0.5 0"
                  align="center"
                  color="white"
                  width="4"
                  scale="2 2 2"></a-text>
          
          <a-text value="Puntuación:"
                  position="0 0 0"
                  align="center"
                  color="#CCCCCC"
                  width="2"
                  scale="1 1 1"></a-text>
          
          <a-text id="game-score" value="0"
                  position="0 -0.3 0"
                  align="center"
                  color="#FF440C"
                  width="2"
                  scale="1.5 1.5 1.5"></a-text>
          
          <a-text id="game-over-copy-desktop"
                  value="Botón A: Jugar de nuevo"
                  position="0 -0.8 0"
                  align="center"
                  color="#CCCCCC"
                  width="3"
                  scale="1 1 1"></a-text>
        </a-entity>
        
      </a-entity>
      
      <!-- Suelo de referencia -->
      <a-circle position="0 0 0" radius="20" rotation="-90 0 0" 
                material="color: #1a2b3c; opacity: 0.3; transparent: true"></a-circle>
      
      <!-- Cielo -->
      <a-sky color="#a3d0ed"></a-sky>
      
    </a-scene>
    
    <script>
      // Script de inicialización
      document.addEventListener('DOMContentLoaded', function() {
        console.log('DOM loaded, VR game ready');
        
        // Detectar si estamos en un headset VR
        if (navigator.xr) {
          console.log('WebXR available');
          navigator.xr.isSessionSupported('immersive-vr').then(function(supported) {
            console.log('VR supported:', supported);
          });
        }
      });
    </script>
  </body>
</html>